https://zhuanlan.zhihu.com/p/222865842



# 第一章 单表查询



## 1、SELECT、WHERE clause

```sql
USE sql_store;

SELECT * 
FROM customers
WHERE customer_id = 1
ORDER BY first_name;
-- 单行注释
/*
多行注释
*/
```

![image-20231015155328520](E:\LYHfiles\notes\LearningNotes\TyporaImgs\image-20231015155328520.png)

SQL会完全无视大小写（绝大数情况下的大小写）、多余的空格（超过一个的空格）、缩进和换行，SQL语句间完全由分号 `;` 分割

## 2、AND、OR、NOT clause

```sql
USE sql_store;

SELECT * FROM Customers
where birth_date > '1990-01-01' AND points > 1000
```

![image-20231017215258841](../TyporaImgs/image-20231017215258841.png)

From the order_items table, get the items for order #6 where the total price is greater than 30

![image-20231017215951803](../TyporaImgs/image-20231017215951803.png)

## 3、IN、BETWEEN clause



![image-20231017220355030](../TyporaImgs/image-20231017220355030.png)

Return products with quantity in stock equal to 49,38,72
```sql
SELECT * FROM products
WHERE quantity_in_stock IN (49,38,72)
```

Return customers born between 1/1/1990 and 1/1/2000

```sql
SELECT * FROM customers
where birth_date BETWEEN '1990-01-01' AND '2000-01-01'
```

## 4、字符串搜索

### 4.1 LIKE clause

模糊查找，查找具有某种模式的字符串的记录/行

两种通配符(忽略大小写)：

- `%` 任何个数（包括0个）的字符
- `_` 单个字符

![image-20231017221442298](../TyporaImgs/image-20231017221442298.png)

![image-20231017221624639](../TyporaImgs/image-20231017221624639.png)

Get the customers whose addresses contain TRAIL or AVENUE

``` sql
SELECT * FROM customers
WHERE address LIKE '%TRAIL%' OR address LIKE '%AVENUE%'
```

Get the customers whose phone numbers end with 9

```sql
SELECT * FROM customers
WHERE phone LIKE '%9';
```



### 4.2 REGEXP clause

正则表达式，在搜索字符串方面更为强大，可搜索更复杂的模板

```sql
SELECT * FROM customers
WHERE last_name LIKE '%y%'; 
-- 等价于
SELECT * FROM customers
WHERE last_name REGEXP 'y';
```

|  符号  |           意义            |
| :----: | :-----------------------: |
|   ^    |           开头            |
|   $    |           结尾            |
| [abc]x |       含ax或bx或cx        |
| [a-d]x | 等价于[abcd]x，即含a到d x |
|   \|   |        logical or         |

Get the customers whose

1. first names 是 ELKA 或 AMBUR
2.  last names 以 EY 或 ON 结束
3. last names 以 MY 开头 或包含 SE
4. last names contains b followed by R or U

```sql
-- 1. first names 是 ELKA 或 AMBUR
SELECT * FROM customers 
WHERE first_name REGEXP 'ELKA|AMBUR'
-- 2.  last names 以 EY 或 ON 结束
SELECT * FROM customers 
WHERE last_name REGEXP 'EY$|ON$'
-- 3. last names 以 MY 开头 或包含 SE
SELECT * FROM customers 
WHERE last_name REGEXP '^MY|SE'
-- 4. last names contains b followed by R or U
SELECT * FROM customers 
WHERE last_name REGEXP 'b[RU]'
```

## 5、NULL 判断

Get the orders that are not shipped

```sql
USE sql_store;

SELECT * FROM orders WHERE shipped_date IS null
```

Get the orders that are not shipped

## 6、分页

### 6.1 ORDER BY clause

可以起别名，并按照别名排序

```sql
SELECT *,quantity * unit_price AS total
FROM order_items 
ORDER BY total DESC
```

可以使用列位置给数据排序

<img src="../TyporaImgs/image-20231018212354082.png" alt="image-20231018212354082" style="zoom: 60%;" />

###  6.2 LIMIT clause

限制返回结果的记录数量，“前N个” 或 “跳过M个后的前N个”

取前三个

```sql
SELECT * FROM  customers
LIMIT 3
```

假设页大小为3，第一页：1-3；第二页：4-6；…，第三页的数据如下，第一个参数是offset，第二个参数是取的个数

```sql
SELECT * FROM  customers
LIMIT 6,3
```

# 第二章 多表查询

## 1、INNER JOIN 内连接

默认JOIN 是 INNER JOIN

在order_items表基础上添加product name

```sql
SELECT oi.order_id,p.product_id,p.name,oi.quantity,oi.unit_price
FROM order_items AS oi
INNER JOIN products AS p ON oi.product_id = p.product_id
```

JOIN的两张表在不同的数据库中时，使用前缀区分

![image-20231018214836149](../TyporaImgs/image-20231018214836149.png)

查询payments表的详细数据（连接clients和payment_methods）

```sql
SELECT p.payment_id,c.name AS client_name,
		invoice_id,date,amount,pm.name AS payment_methods
FROM payments p
JOIN clients c ON p.client_id = c.client_id
JOIN payment_methods pm ON p.payment_method = pm.payment_method_id;
```

### 1.1、SELF JOIN 自连接

一张表连接自己，比如employees表中只存储了上级id，若想知道上级名称则需要执行自连接

<img src="../TyporaImgs/image-20231018215739903.png" alt="image-20231018215739903" style="zoom:60%;" />

### 1.2、Compound Join Condition复合连接条件

如下图，order_items表没有唯一的主键，使用的是order_id和product_id的复合主键。当使用复合连接主键作为连接条件时，注意使用AND组合两个主键

<img src="../TyporaImgs/image-20231018221321818.png" alt="image-20231018221321818" style="zoom:60%;" />

![image-20231018221428432](../TyporaImgs/image-20231018221428432.png)



### 1.3、Implicit JOIN隐式链接

下面两种写法是等价的，但是推荐使用显示连接即第一种写法

```sql
SELECT * 
FROM orders o 
JOIN customers c ON o.customer_id = c.customer_id;

SELECT * 
FROM orders o,customers c
where o.customer_id = c.customer_id;
```

## 2、OUTTER JOIN 外连接

### 2.1 LEFT JOIN

在order_items表中只有部分的product，要显示所有product的订购情况只能使用LEFT JOIN

```sql
SELECT p.product_id,p.name,oi.quantity
FROM products p
LEFT JOIN order_items oi ON p.product_id = oi.product_id;
```

LEFT  JOIN和RIGHT JOIN是可以相互转换的

### 2.2 RIGHT JOIN

```sql
SELECT p.product_id,p.name,oi.quantity
FROM order_items oi
RIGHT JOIN products p ON p.product_id = oi.product_id;
```

